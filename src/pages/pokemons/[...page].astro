---
import type { GetStaticPaths, Page } from "astro";
import Layout from "../../layout/Layout.astro";

interface Pokemon {
  name: string;
  url: string;
  id: string;
  image: string;
}

export const getStaticPaths = (async ({ paginate }) => {
  const response = await fetch("https://pokeapi.co/api/v2/pokemon?limit=151");
  const { results } = await response.json();
  const pokemons = results.map((pokemon: any) => {
    const id = pokemon.url.split("/").filter(Boolean).pop();
    return {
      ...pokemon,
      id,
      image: `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${id}.png`,
    };
  });

   return paginate(pokemons, {
    pageSize: 5
  });
}) satisfies GetStaticPaths;

type Props = {
  page: Page<Pokemon>;
};

const { page } = Astro.props;
---

<Layout>
  <section>
    <div
      class="p-10 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 w-full items-center justify-center"
    >
      {
        page.data.map((pokemon: any) => (
          <a
            href={`/pokemons/${pokemon.name}`}
            class="flex flex-col items-center group bg-slate-700 p-4 rounded-xl border border-salate-700"
          >
            <div class=" overflow-hidden ">
              <img
                src={pokemon.image}
                alt={`imagen de ${pokemon.name}`}
                class="w-fit group-hover:scale-110 transition-all object-contain"
              />
            </div>
            <p class="text-center mt-2 capitalize font-mono text-white text-xl">
              {pokemon.name}
            </p>
          </a>
        ))
      }
    </div>
    <nav class="flex justify-center items-center gap-4 *:text-white">
      {
        page.url.prev ? (
          <a
            href={page.url.prev}
            class="bg-violet-600 px-6 py-3 rounded-full transition font-semibold hover:bg-violet-700"
          >
            ir atrás
          </a>
        ) : (
          <span class="bg-slate-700 px-6 py-3 rounded-full font-bold">
            ir atrás
          </span>
        )
      }
      <span class="bg-violet-800 px-6 py-3 rounded-full font-bold">
        {page.currentPage}/ {page.lastPage}
      </span>

      {
        page.url.next ? (
          <a
            href={page.url.next}
            class="bg-violet-600 px-6 py-3 rounded-full transition font-semibold hover:bg-violet-700"
          >
            Siguiente
          </a>
        ) : (
          <span class="bg-slate-700 px-6 py-3 rounded-full font-bold">
            Siguiente
          </span>
        )
      }
    </nav>
  </section>
</Layout>
